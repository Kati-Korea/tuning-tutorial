<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>초보자를 위한 안티 롤바 | 코너링 안정성 업 설치 가이드</title>
  <style>
    :root { --bg:#ffffff; --text:#222; --muted:#666; --primary:#0c6efd; --accent:#f0f4ff; --card:#fafafa; --border:#e5e7eb; --caption-bg:#f8fafc; --caption-text:#6b7280; --ad-bg:#d8d8d8; }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",Arial,"Apple SD Gothic Neo","Malgun Gothic","맑은 고딕",sans-serif;background:var(--bg);color:var(--text);line-height:1.65}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1040px;margin:0 auto;padding:24px}
    .partner-inner{max-width:1040px;margin:0 auto;padding:10px 24px;display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center;text-align:center}
    .partner{display:flex;align-items:center;gap:6px}
    .partner img{height:28px;width:auto;object-fit:contain;display:block}
    .partner .text-box{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:28px}
    .partner .name{font-size:13px;font-weight:600;color:var(--text);margin:0}
    .partner .url{font-size:11px;color:var(--muted);margin:0}
    header .brand{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:center;text-align:center;width:100%}
    header .brand h1{width:100%;margin:0;font-size:20px;font-weight:700}
    .grid{display:grid;grid-template-columns:1.2fr 2fr;gap:24px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .toc{position:sticky;top:12px;align-self:start;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
    .toc h3{margin:0 0 12px;font-size:16px;border-bottom:1px dashed var(--border);padding-bottom:8px;text-align:center}
    .toc ol{margin:0;padding-left:16px;font-size:13px;line-height:1.5}
    .toc li{margin:4px 0}
    .back{display:block;width:100%;text-align:center;padding:8px 12px;border-radius:8px;background:#eef2ff;border:1px solid var(--border);color:#1f2937;font-size:14px;font-weight:600;margin-bottom:12px;text-decoration:none}
    .back:hover{filter:brightness(1.03);text-decoration:none}
    .banner-stack{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .banner{display:grid;grid-template-columns:88px 1fr;gap:10px;width:100%;background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;text-decoration:none;transition:box-shadow .2s ease,transform .2s ease;align-items:center}
    .banner:hover{box-shadow:0 4px 14px rgba(0,0,0,0.08);transform:translateY(-1px)}
    .banner .content .title{margin:0;font-size:14px;color:var(--text);font-weight:600}
    .banner .content .desc{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .section{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:18px;position:relative}
    .section h3{margin:0 0 8px;font-size:18px}
    .section .subtitle{color:var(--muted);margin-bottom:12px;font-size:14px}
    .callout{background:var(--accent);border-left:4px solid var(--primary);padding:10px 12px;border-radius:6px;margin:10px 0;font-size:14px}
    .footer{margin-top:16px;padding:16px 0 40px;color:var(--muted);font-size:13px;border-top:1px solid var(--border)}
    .tag{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted);margin-right:6px}
    figure.img-card{margin:8px auto 12px;padding:8px;border:1px solid var(--border);border-radius:10px;background:#fff;width:fit-content}
    .img-376,.img-576,.img-vid,.img-ad{overflow:hidden;border-radius:6px}
    .img-376{width:376px;height:376px}
    .img-576{width:576px;height:576px}
    .img-vid{width:376px;height:211px}
    .img-ad{width:576px;height:776px;border-radius:8px}
    .img-376>img,.img-576>img,.img-vid>img,.img-ad>img{width:100%;height:100%;object-fit:cover;object-position:center;display:block}
    /* 캡션(제목/출처) */
    figcaption.title{margin-top:6px;font-weight:700;color:#0f172a;font-size:13px}
    figcaption.source{margin-top:2px;color:#64748b;font-size:12px}
    .center{text-align:center}
    .center-inline{display:inline-block}
    /* 광고 영역 */
    .ad-section{background:var(--ad-bg);border-color:#cfcfcf}
    .ad-card{display:inline-block;padding:10px;border-radius:10px;background:#fff;border:1px solid var(--border)}
    .ad-link{display:inline-block;margin-top:6px;font-size:12px;color:var(--muted)}
    /* 비디오 모달 */
    .video-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px}
    .video-overlay.active{display:flex}
    .video-modal{position:relative;background:#000;border-radius:10px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.35);width:min(90vw,1280px);height:min(80vh,720px)}
    .video-modal iframe{width:100%;height:100%;display:block;border:0}
    .video-close{position:absolute;top:8px;right:8px;background:rgba(255,255,255,0.9);color:#111;border:none;border-radius:999px;width:32px;height:32px;font-size:18px;cursor:pointer;line-height:32px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,0.2)}
    .video-close:hover{background:#fff}
    .video-thumb{cursor:pointer}
    .video-error {
      position:fixed; left:50%; top:16px; transform:translateX(-50%);
      background:#fee2e2; color:#991b1b; border:1px solid #fecaca; border-radius:8px;
      padding:8px 12px; font-size:12px; display:none; z-index:1100;
      box-shadow:0 6px 16px rgba(0,0,0,0.15);
    }
    .video-error a { color:#991b1b; text-decoration:underline; }
  </style>
  <link rel="icon" href="/logo_Icon.ico">
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>초보자를 위한 안티 롤바 · 코너링 안정성 업 설치 가이드</h1>
        <span class="tag">입문용</span>
        <span class="tag">한국 기준</span>
      </div>
      <div class="partner-inner">
        <a class="partner" href="http://www.katiagroup.or.kr/" target="_blank" rel="noopener" aria-label="KATIA">
          <img src="../image/logo_new.png">
          <div class="text-box">
            <div class="name">Korea Auto Tuning Industry Association</div>
            <div class="url">www.katiagroup.or.kr</div>
          </div>
        </a>
        <a class="partner" href="http://www.kal.ac.kr" target="_blank" rel="noopener" aria-label="KAL">
          <img src="../image/kal_logo.png">
          <div class="text-box">
            <div class="name">KAL</div>
            <div class="url">www.kal.ac.kr</div>
          </div>
        </a>
      </div>
    </header>

    <div class="grid">
      <nav class="toc">
        <a class="back" href="../menu01.html" aria-label="이전 페이지로">← 이전 페이지</a>
        <h3>안티 롤바</h3>
        <h3>▣ 목 차 ▣</h3>
        <ol>
          <li><a href="#cover">표지</a></li>
          <li><a href="#why">왜 안티 롤바인가</a></li>
          <li><a href="#types">유형/재질</a></li>
          <li><a href="#principle">작동 원리(롤 억제)</a></li>
          <li><a href="#law">법규/안전</a></li>
          <li><a href="#tools">준비물·공구·부자재</a></li>
          <li><a href="#prep">작업 전 준비</a></li>
          <li><a href="#sop">SOP: 안티 롤바 설치</a></li>
          <li><a href="#torque">토크/정렬/세팅</a></li>
          <li><a href="#test">테스트 드라이브</a></li>
          <li><a href="#trouble">트러블슈팅</a></li>
          <li><a href="#maint">유지관리/교체주기</a></li>
          <li><a href="#faq">FAQ</a></li>
          <li><a href="#appendix">부록</a></li>
        </ol>

        <!-- 왼쪽 메뉴 하단 광고 시작: 변경 금지 -->
        <div class="banner-stack" aria-label="권장 링크 배너">
          <a class="banner" href="https://maintec.co.kr/" target="_blank" rel="noopener">
            <img src="https://maintec.co.kr/images/logo.svg" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border);display:block">
            <div class="content">
              <p class="title">메인텍</p>
              <p class="desc">브레이크/정비 장비 정보 및 서비스</p>
            </div>
          </a>
          <a class="banner" href="https://blog.naver.com/sunnmotors/130074721201" target="_blank" rel="noopener">
            <img src="https://blogpfthumb-phinf.pstatic.net/20091130_57/sunnmotors_1259559152773_Ytp8J8_jpg/%BD%E3%B5%F0%BD%BA%C5%A907.jpg?type=w161" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border);display:block">
            <div class="content">
              <p class="title">SUN&MOTORS</p>
              <p class="desc">ABS 관련 정비 사례 블로그</p>
            </div>
          </a>
          <a class="banner" href="https://main.kotsa.or.kr/main.do" target="_blank" rel="noopener">
            <img src="https://main.kotsa.or.kr/web/images/common/logo.svg" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border);display:block">
            <div class="content">
              <p class="title">TS한국교통안전공단</p>
            </div>
          </a>
        </div>
        <!-- 왼쪽 메뉴 하단 광고 끝 -->
      </nav>

      <main>
          <!-- 표지 -->
          <section id="cover" class="section">
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-576">
                          <img src="https://sc02.alicdn.com/kf/HTB1guWvnntYBeNjy1Xdq6xXyVXaL/206144098/HTB1guWvnntYBeNjy1Xdq6xXyVXaL.jpg">
                      </div>
                      <figcaption class="title">안티 롤바 · 코너링 롤 억제로 안정성 향상</figcaption>
                      <figcaption class="source">출처 : Alibaba https://korean.alibaba.com/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 1. 왜 안티 롤바인가 -->
          <section id="why" class="section" data-index="1">
              <h3>01. 왜 안티 롤바인가</h3>
              <div class="subtitle">좌우 롤(차체 기울기) 억제로 코너링 안정성·응답성 향상</div>
              <ul>
                  <li>언더/오버스티어 밸런스 보정, 승차감·제동 시 자세 유지</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="http://www.ridemag.co.kr/news/photo/201511/5452_8.jpg">
                      </div>
                      <figcaption class="title">코너링 중 롤 억제와 밸런스 향상</figcaption>
                      <figcaption class="source">출처 : 라이드매거진 http://www.ridemag.co.kr/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 2. 유형/재질 -->
          <section id="types" class="section" data-index="2">
              <h3>02. 유형/재질</h3>
              <ul>
                  <li>고정형/가변형(홀 위치), 전륜/후륜/양쪽, 강재/크롬몰리/속빈튜브</li>
                  <li>부시 재질: 고무/폴리우레탄</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="http://www.ridemag.co.kr/news/photo/201511/5452_19.jpg">
                      </div>
                      <figcaption class="title">전·후륜 바와 부시/링크 타입</figcaption>
                      <figcaption class="source">출처 : 라이드매거진 http://www.ridemag.co.kr/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 3. 작동 원리(롤 억제) -->
          <section id="principle" class="section" data-index="3">
              <h3>03. 작동 원리(롤 억제)</h3>
              <ul>
                  <li>좌우 서스펜션을 토션으로 연결해 롤 각도 저감, 링크 위치·홀로 강성 조절</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="http://www.ridemag.co.kr/news/photo/201511/5452_6.jpg">
                      </div>
                      <figcaption class="title">토션 작용과 강성 조절 원리</figcaption>
                      <figcaption class="source">출처 : 라이드매거진 http://www.ridemag.co.kr/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 4. 법규/안전 -->
          <section id="law" class="section" data-index="4">
              <h3>04. 법규/안전(한국)</h3>
              <ul>
                  <li>차체·프레임 천공 시 승인·검사 절차 확인, 배선·브레이크 라인 간섭 금지</li>
                  <li>하부 작업 안전: 리프트 지지·토크 규정 준수</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://postfiles.pstatic.net/MjAxNzEwMDFfNjkg/MDAxNTA2ODQ5NzE2NTA0.Jw8LIo4ipt1Q2M_rOwFjbcTTNAZlZeCjbLlp3jtUj04g.EeFcH1q2_uAZPHKc_t2ux9glecBqzh-2AQLBseL9JIQg.JPEG.cogram/%EC%95%88%ED%8B%B0%EB%A1%A4%EB%B0%94_1.jpg?type=w966">
                      </div>
                      <figcaption class="title">검사 기준과 하부 작업 안전</figcaption>
                      <figcaption class="source">출처 : 사냥꾼 https://blog.naver.com/cogram</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 5. 준비물·공구·부자재 -->
          <section id="tools" class="section" data-index="5">
              <h3>05. 준비물·공구·부자재</h3>
              <ul>
                  <li>토크렌치, 롤바 링크/부시, 그리스, 잭/리프트, 임팩/라쳇, 트림 리무버</li>
                  <li>서비스 매뉴얼, 강성 조절용 링크(가변형), 스레드락</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://sc04.alicdn.com/kf/S57ca3282e5f543c381b514d8445f068cF.png">
                      </div>
                      <figcaption class="title">안티 롤바 설치 필수 공구 세트</figcaption>
                      <figcaption class="source">출처 : Alibaba https://korean.alibaba.com/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 6. 작업 전 준비 -->
          <section id="prep" class="section" data-index="6">
              <h3>06. 작업 전 준비</h3>
              <ul>
                  <li>차량 지지·안전 확보, 기존 바/부시 상태 확인, 부품 배치 사전 점검</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://postfiles.pstatic.net/MjAyMDAyMDVfMTI4/MDAxNTgwODc0OTM3NTc2.x9SyeonYo85h2JQKPsw29W09v5ZGDkOjjK11MmvAmhkg.kW57VSVng7nXRisoqD4kpsREogc3AQMs79OLR-QBedUg.JPEG.tuning_story/IMG_9481.jpg?type=w966">
                      </div>
                      <figcaption class="title">지지 안전과 기존 부품 상태 점검</figcaption>
                      <figcaption class="source">출처 : 네이버 / TNS https://blog.naver.com/tuning_story</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 7. SOP: 안티 롤바 설치 -->
          <section id="sop" class="section" data-index="7">
              <h3>07. SOP: 안티 롤바 설치</h3>
              <ul>
                  <li>기존 바/부시 탈거→신품 바 포지션→부시 그리스→브래킷 고정→링크 체결→규정 토크</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-vid video-thumb" data-video-id="3gfyDLRUThY" data-video-url="https://www.youtube.com/watch?v=3gfyDLRUThY" role="button" aria-label="안티 롤바 설치 영상 재생">
                          <img src="../image/ANLB_YT_01.png">
                      </div>
                      <figcaption class="title">탈거·부시 그리스·브래킷/링크 체결 절차</figcaption>
                      <figcaption class="source">출처 : YouTube 카멀티샵 THE MOST 더모스트</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 8. 토크/정렬/세팅 -->
          <section id="torque" class="section" data-index="8">
              <h3>08. 토크/정렬/세팅</h3>
              <ul>
                  <li>차량 하중 상태에서 링크 체결, 좌우 프리로드 최소화, 규정 토크로 재점검</li>
                  <li>가변형은 홀/링크 위치로 강성 단계 세팅</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://postfiles.pstatic.net/MjAyNTAzMDdfNTAg/MDAxNzQxMjkyMzIxMzYy.VPt5jnBOKHWcC9OQfIx5U6GqUKE7HQV466rTyYDTXTMg.GDTCAX0m5VwRmmb6VLoYrF1A37PRCcPrHGn6KIzMVnog.JPEG/image.JPEG?type=w773">
                      </div>
                      <figcaption class="title">프리로드 최소화와 규정 토크 적용</figcaption>
                      <figcaption class="source">출처 : 네이버 / Black Mamba Auto https://blog.naver.com/bmautoparts/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 9. 테스트 드라이브 -->
          <section id="test" class="section" data-index="9">
              <h3>09. 테스트 드라이브</h3>
              <ul>
                  <li>저속 노면 소음·진동 확인, 코너링 응답성·롤 감소 체감, 체결부 재점검</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://postfiles.pstatic.net/MjAxNzA0MDNfMTQ0/MDAxNDkxMTUzNDU0MTQ3.VKaETe2LPPvpuMXQhZPM1QNYmuRA6cbBS7m2jKBG0tEg.uLXoc_jfiex87hQh4fcRVuCRNn8mwdGqyMwsmEG2KR8g.JPEG.girff/Sway_bar_illust1.jpg?type=w2">
                      </div>
                      <figcaption class="title">롤 억제 체감과 체결부 이상 점검</figcaption>
                      <figcaption class="source">출처 : 네이버 / JohnL https://blog.naver.com/girff</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 10. 트러블슈팅 -->
          <section id="trouble" class="section" data-index="10">
              <h3>10. 트러블슈팅</h3>
              <ul>
                  <li>소음: 부시 윤활/토크 재점검, 프리로드: 링크 길이/위치 조정, 간섭: 라우팅 수정</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://d2yvw3vh7zamx3.cloudfront.net/data/tuningContents/themostcar/ohcar_bi_32_223531551296.jpg">
                      </div>
                      <figcaption class="title">소음·프리로드·간섭 문제 해결</figcaption>
                      <figcaption class="source">출처 : 오늘의카 https://m.oh-car.co.kr/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 중간 광고 시작 -->
          <section class="section ad-section">
              <div class="center">
                  <div class="ad-card">
                      <a href="https://maintec.co.kr/" target="_blank" rel="noopener" aria-label="메인텍 이동">
                          <div class="img-ad">
                              <img src="https://maintec.co.kr/data/item/1738890706/thumb-67Cw6rK9_413x560.jpg">
                          </div>
                      </a>
                      <div class="ad-link">메인텍 · 출처: maintec.co.kr/shop/list.php?ca_id=80</div>
                  </div>
              </div>
          </section>
          <!-- 중간 광고 끝 -->

          <!-- 11. 유지관리/교체주기 -->
          <section id="maint" class="section" data-index="11">
              <h3>11. 유지관리/교체주기</h3>
              <ul>
                  <li>부시 마모 점검·윤활, 링크 너트 토크 재점검, 균열·부식 시 교체</li>
              </ul>
              <div class="center">
                  <figure class="img-card center-inline">
                      <div class="img-376">
                          <img src="https://d2yvw3vh7zamx3.cloudfront.net/data/tuningContents/themostcar/ohcar_bi_6_223531551296.jpg">
                      </div>
                      <figcaption class="title">부시·링크·브래킷 유지관리 루틴</figcaption>
                      <figcaption class="source">출처 : 오늘의카 https://m.oh-car.co.kr/</figcaption>
                  </figure>
              </div>
          </section>

          <!-- 12. FAQ -->
          <section id="faq" class="section" data-index="12">
              <h3>12. FAQ</h3>
              <ul>
                  <li>가변형 바가 항상 좋은가? 용도·승차감·언더/오버 밸런스 고려</li>
                  <li>부시 재질 선택은? 소음·내구성·유지관리 편의 기준으로</li>
              </ul>
          </section>

          <!-- 13. 부록 -->
          <section id="appendix" class="section" data-index="13">
              <h3>13. 부록</h3>
              <ul>
                  <li>규정 토크 표, 링크 위치별 강성 단계, 증상-원인 체크리스트</li>
              </ul>
          </section>

          <!-- 하단 광고: 변경 금지 -->
          <section class="section ad-section">
              <div class="center">
                  <div class="ad-card">
                      <a href="https://blog.naver.com/sunnmotors" target="_blank" rel="noopener" aria-label="썬앤모터스 블로그 이동">
                          <div class="img-ad">
                              <img src="https://postfiles.pstatic.net/MjAxODA1MDRfMzAg/MDAxNTI1NDA2NTI3OTQy.VOyjb-3q6iLxYmu8GdSSdFHfhtPihTrT3e2MpJCCC0Mg.625LZZ7ZqUkoBTuLSp1RtB5SKTtxbs5hGrwByY4eOsMg.JPEG.sunnmotors/image_2878216691525406433468.jpg?type=w966">
                          </div>
                      </a>
                      <div class="ad-link">썬앤모터스 · 출처: blog.naver.com/sunnmotors</div>
                  </div>
              </div>
          </section>
      </main>
    </div>

    <div class="footer">
      <div class="center">작업/검사 전 차량 매뉴얼과 국내 법규(TS 등)를 확인하고, 지지 안전·프리로드·토크·윤활 수칙을 준수하세요.</div>
    </div>
  </div>

  <div class="video-error" id="videoError" role="alert" aria-live="polite">
    동영상 임베드가 제한되어 재생할 수 없습니다. 아래 링크로 YouTube에서 직접 보세요.
    <a id="videoOpenLink" href="#" target="_blank" rel="noopener">YouTube에서 열기</a>
  </div>

  <div class="video-overlay" id="videoOverlay" aria-hidden="true">
    <div class="video-modal" role="dialog" aria-modal="true" aria-label="영상 재생">
      <button class="video-close" id="videoClose" aria-label="닫기">✕</button>
      <iframe id="videoFrame"
              src=""
              title="YouTube video player"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
              allowfullscreen>
      </iframe>
    </div>
  </div>

  <script>
    const DEBUG_LOG = false;
    function log(){ if(DEBUG_LOG) console.log.apply(console, arguments); }

    function buildEmbedUrl(videoId, startSec, useNoCookie, autoplay = true, muted = true, controls = 1, playsinline = 1) {
      if (!videoId) return null;
      const base = useNoCookie ? 'https://www.youtube-nocookie.com' : 'https://www.youtube.com';
      const params = new URLSearchParams({ rel:'0', modestbranding:'1', playsinline:String(playsinline), controls:String(controls), enablejsapi:'1', origin: window.location.origin });
      if (autoplay) params.set('autoplay','1');
      if (muted) params.set('mute','1');
      if (startSec) { const s=String(startSec).replace('s',''); if(/^\d+$/.test(s)) params.set('start', s); }
      return `${base}/embed/${videoId}?${params.toString()}`;
    }
    function extractVideoId(raw) {
      if (!raw) return null;
      if (/^[A-Za-z0-9_-]{6,}$/.test(raw) && !raw.includes('http')) return raw;
      try {
        const url = new URL(raw); const host = url.hostname.replace('www.','');
        if (host.includes('youtu.be')) return url.pathname.slice(1);
        if (host.includes('youtube')) {
          if (url.pathname === '/watch') return url.searchParams.get('v');
          if (url.pathname.startsWith('/shorts/')) return url.pathname.split('/')[2];
          if (url.pathname.startsWith('/embed/')) return url.pathname.split('/')[2];
        }
      } catch(e) {
        const m = String(raw).match(/(?:youtu\.be\/|v=|\/shorts\/|\/embed\/)([A-Za-z0-9_-]{6,})/);
        if (m) return m[1];
      }
      return null;
    }
    const overlay=document.getElementById('videoOverlay');
    const frame=document.getElementById('videoFrame');
    const btnClose=document.getElementById('videoClose');
    const errorBanner=document.getElementById('videoError');
    const openLink=document.getElementById('videoOpenLink');

    function showError(originalUrl){ if(!errorBanner) return; openLink.href=originalUrl||'#'; errorBanner.style.display='block'; clearTimeout(showError._t); showError._t=setTimeout(()=>{ errorBanner.style.display='none'; },8000); }
    function openOverlay(){ overlay.classList.add('active'); overlay.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; btnClose.focus(); }
    function closeOverlay(){ overlay.classList.remove('active'); overlay.setAttribute('aria-hidden','true'); document.body.style.overflow=''; try{ frame.src=''; }catch(e){} }
    async function tryPlaySequence({ id, start, originalUrl }) {
      openOverlay();
      try { frame.src = buildEmbedUrl(id, start, false, true, true); }
      catch(e1){ try { frame.src = buildEmbedUrl(id, start, true, true, true); } catch(e2){ closeOverlay(); showError(originalUrl); } }
    }
    document.addEventListener('click', function (e) {
      const thumb = e.target.closest('.video-thumb'); if(!thumb) return; e.preventDefault();
      let id=thumb.getAttribute('data-video-id')||''; let start=thumb.getAttribute('data-start')||''; let originalUrl=thumb.getAttribute('data-video-url')||'';
      if(!id && originalUrl){ id = extractVideoId(originalUrl); try{ const u=new URL(originalUrl); start = start || u.searchParams.get('t') || u.searchParams.get('start') || ''; }catch(e){} }
      if(!originalUrl && id) originalUrl=`https://www.youtube.com/watch?v=${id}`;
      if(id) tryPlaySequence({ id, start, originalUrl }); else if(originalUrl) showError(originalUrl);
    });
    btnClose.addEventListener('click', closeOverlay);
    overlay.addEventListener('click', function(e){ if(e.target===overlay) closeOverlay(); });
    document.addEventListener('keydown', function(e){ if(e.key==='Escape' && overlay.classList.contains('active')) closeOverlay(); });
  </script>
</body>
</html>